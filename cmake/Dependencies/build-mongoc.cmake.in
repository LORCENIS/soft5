# -*- Mode: cmake -*-
# This file is processed by BuildExternalProject.cmake
cmake_minimum_required(VERSION 2.8)
include(ExternalProject)


if(CROSS_TARGET)
  if(MINGW_NAME)
    set(hostopt "--host=${MINGW_NAME}")
  else()
    set(hostopt "--host=${CROSS_TARGET}")
  endif()
endif()


# We use autoconf here, since the cmake configuration of hdf5 does
# not work with cross-compiling
ExternalProject_Add(
  mongoc
  PREFIX "${SOFT_DEPS_PREFIX}"

  GIT_REPOSITORY    "https://github.com/mongodb/mongo-c-driver.git"
  GIT_TAG           "1.5.3"

  UPDATE_COMMAND    ""
  PATCH_COMMAND     ""

  SOURCE_DIR        "${SOFT_DEPS_PREFIX}/src/mongoc-src"
  CONFIGURE_COMMAND cd ${SOFT_DEPS_PREFIX}/src/mongoc-src && ./autogen.sh ${hostopt} --prefix=${SOFT_DEPS_PREFIX} --with-libbson=bundled

  BUILD_COMMAND     cd ${SOFT_DEPS_PREFIX}/src/mongoc-src && make

  INSTALL_COMMAND   cd ${SOFT_DEPS_PREFIX}/src/mongoc-src && make install
  )
